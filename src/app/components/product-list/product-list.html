<section class="lg:w-200">
  <ul class="grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-8 w-full">
    @for (product of products(); track product.id) {
    <li class="flex flex-col gap-2 w-full">
      <div class="relative">
        <a
          [routerLink]="['/product', product.id]"
          class="absolute top-2 right-2 z-10 size-8 flex items-center justify-center rounded-full bg-white/80 hover:bg-white text-rose-500 hover:text-red transition-colors cursor-pointer shadow-sm"
          aria-label="View details for {{ product.name }}"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            fill="currentColor"
            viewBox="0 0 256 256"
          >
            <path
              d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"
            ></path>
          </svg>
        </a>
        <picture>
          <source media="(min-width: 1024px)" [srcset]="product.image.desktop" />
          <source media="(min-width: 768px)" [srcset]="product.image.tablet" />
          <img
            [src]="product.image.mobile"
            [alt]="product.name"
            width="327"
            height="212"
            loading="lazy"
            [class]="'w-81.75 h-53 md:w-[213.33px] md:h-53 lg:w-[250.67px] lg:h-60 object-cover rounded-lg ' + (isInCart(product.id) ? 'ring-2 ring-red' : '')"
          />
        </picture>
        <div class="absolute -bottom-6 z-10 w-full flex items-center justify-center">
          @if (isInCart(product.id)) {
          <div class="bg-red p-3 w-40 h-11 flex items-center justify-between rounded-full">
            <button
              type="button"
              class="size-5 flex items-center justify-center rounded-full border border-white text-white cursor-pointer hover:bg-white hover:border-transparent hover:text-red transition-colors"
              (click)="handleDecrement($event, product)"
              aria-label="Decrease quantity"
            >
              <ng-icon name="featherMinus" size="14" />
            </button>
            <span class="text-white text-preset-4 font-semibold"
              >{{ getQuantity(product.id) }}</span
            >
            <button
              type="button"
              class="size-5 flex items-center justify-center rounded-full border border-white text-white cursor-pointer hover:bg-white hover:border-transparent hover:text-red transition-colors"
              (click)="handleIncrement($event, product)"
              aria-label="Increase quantity"
            >
              <ng-icon name="featherPlus" size="14" />
            </button>
          </div>
          } @else {
          <button
            type="button"
            class="border border-rose-400 bg-white p-3 w-40 h-11 flex items-center justify-center gap-2 cursor-pointer rounded-full text-preset-4 font-semibold hover:border-red hover:text-red transition-colors"
            (click)="handleAddToCart($event, product)"
          >
            <img src="/images/icon-add-to-cart.svg" alt="" width="21" height="20" class="size-5" />
            Add to Cart
          </button>
          }
        </div>
      </div>
      <div class="flex flex-col justify-between items-start gap-1 pt-10 text-sm">
        <p class="text-rose-500 text-preset-4">{{ product.category }}</p>
        <p class="text-rose-900 text-preset-3 font-semibold">{{ product.name }}</p>
        <p class="text-red text-preset-3 font-semibold">${{ product.price | number:'1.2-2' }}</p>
      </div>
    </li>
    } @empty {
    <p>No products available</p>
    }
  </ul>
</section>
