<div class="flex flex-col xl:flex-row w-fit mx-auto gap-8">
  <div class="flex-1">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
      <h1 class="font-bold text-[40px] mb-4 sm:mb-0">Desserts</h1>
      <div class="w-full sm:w-80">
        <label class="sr-only" for="product-search">Search products</label>
        <input
          id="product-search"
          type="search"
          placeholder="Search desserts"
          class="w-full border border-rose-100 rounded-lg px-3 py-2 text-sm"
          (input)="handleSearch($event)"
        />
      </div>
    </div>
    <app-product-list [products]="(filteredProducts$ | async) ?? []" />
  </div>

  <aside class="w-full lg:w-96 shrink-0 bg-white rounded-lg p-6 h-fit">
    <h2 class="text-red text-preset-2 font-bold mb-6">Your Cart ({{ (cart.totalItems$ | async) ?? 0 }})</h2>

    @if (((cart.cart$ | async)?.items?.length ?? 0) === 0) {
    <div class="flex flex-col items-center justify-center py-4">
      <img src="/images/illustration-empty-cart.svg" alt="" width="128" height="128" />
      <p class="text-rose-500 text-preset-4 mt-4">Your added items will appear here</p>
    </div>
    } @else {
    <ul class="flex flex-col">
      @for (item of (cart.cart$ | async)?.items ?? []; track item.product.id) {
      <li class="flex items-center justify-between py-4 border-b border-rose-100">
        <div class="flex flex-col gap-1">
          <span class="text-rose-900 text-preset-4 font-semibold">{{ item.product.name }}</span>
          <div class="flex items-center gap-2">
            <span class="text-red text-preset-4 font-semibold">{{ item.quantity }}x</span>
            <span class="text-rose-400 text-preset-4">@ ${{ item.product.price | number:'1.2-2' }}</span>
            <span class="text-rose-500 text-preset-4 font-semibold">${{ item.product.price * item.quantity |
              number:'1.2-2' }}</span>
          </div>
        </div>
        <button type="button"
          class="size-5 flex items-center justify-center rounded-full border border-rose-400 text-rose-400 cursor-pointer hover:border-rose-900 hover:text-rose-900 transition-colors"
          (click)="handleRemove(item.product.id)" aria-label="Remove {{ item.product.name }} from cart">
          <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" fill="currentColor" viewBox="0 0 10 10">
            <path d="M8.375 9.375 5 6 1.625 9.375l-1-1L4 5 .625 1.625l1-1L5 4 8.375.625l1 1L6 5l3.375 3.375-1 1Z" />
          </svg>
        </button>
      </li>
      }
    </ul>

    <div class="flex items-center justify-between py-6">
      <span class="text-rose-900 text-preset-4">Order Total</span>
      <span class="text-rose-900 text-preset-2 font-bold">${{ ((cart.totalPrice$ | async) ?? 0) | number:'1.2-2'
        }}</span>
    </div>

    <div class="flex items-center justify-center gap-2 bg-rose-50 rounded-lg py-4 mb-6">
      <img src="/images/icon-carbon-neutral.svg" alt="" width="20" height="20" />
      <p class="text-rose-900 text-preset-4">
        This is a <span class="font-semibold">carbon-neutral</span> delivery
      </p>
    </div>

    <button type="button" id="confirm-order-button"
      class="w-full bg-red text-white text-preset-3 font-semibold py-4 rounded-full cursor-pointer hover:bg-rose-900 transition-colors"
      (click)="handleConfirmOrder()">
      Confirm Order
    </button>
    }
  </aside>
</div>

@if (showConfirmation$ | async) {
<app-order-confirmation [items]="(cart.cart$ | async)?.items ?? []" [totalPrice]="(cart.totalPrice$ | async) ?? 0"
  (startNewOrder)="handleStartNewOrder()" />
}

<router-outlet />